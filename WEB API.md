Документация Web API для управления бортовым модулем ESP8266. Все команды доступны при подключении к Wi-Fi сети планера (`Glider-Timer`).

**Базовый URL:** `http://192.168.4.1`

---

### 1. Статус системы
Возвращает текущее состояние устройства, сенсоров и данные телеметрии. Используется для поллинга (периодического опроса).
*   **Путь:** `/status`
*   **Метод:** `GET`
*   **Пример:** `http://192.168.4.1/status`
*   **Параметры ответа (JSON):**
    *   `status`: "ok" — сервер активен.
    *   `hw_ok`: `true/false` — физическое наличие барометра на I2C шине.
    *   `calibrated`: `true/false` — выполнен ли замер базового давления.
    *   `calibrating`: `true/false` — идет ли процесс калибровки/обнуления в данный момент.
    *   `monitoring`: `true/false` — включен ли активный опрос датчика.
    *   `logging`: `true/false` — включен ли вывод логов в Serial.
    *   `stored_base`: значение базового давления, сохраненное в энергонезависимой памяти (0, если файл отсутствует).
    *   `current_p`: текущее атмосферное давление в Паскалях (доступно при `monitoring: true`).
    *   `base`: текущее активное базовое давление, используемое для расчета высоты.
    *   `alt`: текущая отфильтрованная высота в метрах (появляется после калибровки).
    *   `temp`: температура датчика в °C.
    *   `stable`: `true/false` — индикатор стабильности датчика (отсутствие движения).
    *   `calib_phase`: Строка, текущая фаза операции:
        *   `"idle"` — ожидание.
        *   `"stabilization"` — термостабилизация (прогрев).
        *   `"measuring"` — сбор данных для полной калибровки.
        *   `"zeroing"` — быстрое обнуление.
    *   `calib_progress`: Целое число (0-100), процент выполнения текущей фазы.

---

### 2. Калибровка барометра (Полная)
Запускает процедуру термостабилизации и сбора 2000 образцов давления.
*   **Путь:** `/calibrate`
*   **Метод:** `GET`
*   **Особенности:**
    *   Возвращает код `202 Accepted` (запрос принят).
    *   Процесс **неблокирующий**. Веб-сервер продолжает отвечать на запросы `/status`.
    *   Прогресс отслеживается через поле `calib_progress` в `/status`.
*   **Логи:** Прогресс дублируется в Serial терминале платы.

---

### 3. Быстрое обнуление (Zero)
Устанавливает текущее давление как "ноль метров" (сбор 500 образцов, ~1-2 сек).
*   **Путь:** `/zero`
*   **Метод:** `GET`
*   **Особенности:**
    *   Возвращает код `202 Accepted`.
    *   Процесс **неблокирующий**.
    *   Фаза в статусе будет отображаться как `"zeroing"`.

---

### 4. Отмена операции
Принудительно прерывает текущий процесс калибровки или обнуления.
*   **Путь:** `/cancel`
*   **Метод:** `GET`
*   **Особенности:**
    *   Сбрасывает состояние машины состояний в `IDLE`.
    *   Сбрасывает накопленные данные калибровки.

---

### 5. Сохранение калибровки
Записывает текущее значение базового давления из оперативной памяти в файл `calib.json` (LittleFS).
*   **Путь:** `/calibrate/save`
*   **Метод:** `GET`
*   **Описание:** Позволяет сохранить результат калибровки, чтобы он автоматически загрузился после перезагрузки модуля.

---

### 6. Управление мониторингом барометра
Включает/выключает опрос датчика и расчет высоты.
*   **Путь:** `/baro`
*   **Метод:** `GET`
*   **Аргументы:** `enable=1` (включить), `enable=0` (выключить).
*   **Пример:** `http://192.168.4.1/baro?enable=1`
*   **Примечание:** По умолчанию после включения платы мониторинг выключен для экономии ресурсов.

---

### 7. Управление Serial-логами
Включает или выключает вывод данных телеметрии в Serial-порт (USB).
*   **Путь:** `/log`
*   **Метод:** `GET`
*   **Аргументы:** `enable=1` (включить), `enable=0` (выключить).
*   **Пример:** `http://192.168.4.1/log?enable=1`

---

### 8. Загрузка полетной программы
Записывает новую программу в память устройства.

*   **Путь:** `/program`
*   **Метод:** `POST`
*   **Заголовки:** `Content-Type: application/json`
*   **Тело запроса:** JSON объект программы, содержащий идентификатор, имя и массив шагов.
*   **Пример JSON тела запроса:**
    ```json
    {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "name": "Сильный ветер",
      "steps": [
        {
          "direction": 1,      // 1: по часовой, -1: против
          "durationSec": 5,    // Секунды
          "durationMs": 500    // Миллисекунды (итого 5.5 сек)
        },
        {
          "direction": -1,
          "durationSec": 2,
          "durationMs": 0
        }
      ]
    }
    ```
*   **Особенности:**
    *   Требует валидного JSON.
    *   При успешной загрузке возвращает код `200 OK`.
    *   Если JSON некорректен — возвращает `400 Bad Request`.